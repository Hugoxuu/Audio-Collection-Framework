{% extends "ivrFrameworkWebInterface/base.html" %}

{% block script %}
<script type="text/javascript">
    function toggleButton(user_pin, button_object) {
        if (button_object.innerHTML == 'Show') {
            button_object.innerHTML = 'Hide';
            document.getElementById(user_pin).style.visibility = 'visible';
        } else {
            button_object.innerHTML = 'Show';
            document.getElementById(user_pin).style.visibility = 'hidden';
        }
    }
</script>
{% endblock %}

{% block content %}
<!-- <div class="alert alert-primary" role="alert">User Management:</div>
<div class="container-fluid">
	<div class="row">
		<div class="col"> -->
<div class="alert alert-primary" role="alert">Create New User:</div>
<div class="alert alert-dark" role="alert">
    <form method="post" action="{% url 'userManage' %}">
        <input type="text" name="new_user_name" required id="id_create_new_user_name"
               placeholder="User Name" class="form-control" cols="10">
        <select name="new_user_role" required id="id_create_new_user_role" class="form-control" cols="10">
            <option selected>Choose a Conversation Role...</option>
            <option value="customer">customer</option>
            <option value="agent">agent</option>
        </select>
        <div>
            <input id="id_create_new_user_button" type="submit" class="btn btn-secondary" value="Create">
        </div>
        {% csrf_token %}
    </form>
</div>
<!-- 		</div> -->
<!-- 		<div class="col">
			<div class="alert alert-primary" role="alert">Delete Current User:</div>
			<div class="alert alert-dark" role="alert">
				<form method="post" action="{% url 'userManage' %}">
					<input type="text" name="delete_user_pin" required id="id_delete_user"
		                                    placeholder="User PIN" class="form-control" cols="10">
				    <div>
				    	<input id="id_create_new_user_button" type="submit" class="btn btn-secondary" value="Delete">
				    </div> 
				    {% csrf_token %}		                 
		        </form>                          
			</div>
		</div> -->
<!-- 	</div>
</div> -->

{% if "new_user_pin" in response_list and "new_user_name" in response_list %}
<div class="alert alert-success" role="alert">
    A new user (Name: {{response_list.new_user_name}}, PIN: {{response_list.new_user_pin}}) is created successfully.
    <br/>
    See Detailed Account Info in "List all Current Users".
</div>
{% endif %}
{% if "delete_user_pin" in response_list %}
<div class="alert alert-success" role="alert">
    User "{{response_list.delete_user_pin}}" is Deleted Successfully.
</div>
{% endif %}

{% for error in error_list %}
<div class="alert alert-danger" role="alert">
    {{error}}
</div>
{% endfor %}

{% if user_list %}
<div class="alert alert-primary" role="alert">
    List all Current Users:
</div>
<table class="table table-hover">
    <thead class="thead-dark">
    <tr>
        <th scope="col">User Name</th>
        <th scope="col">User PIN</th>
        <th scope="col">Type</th>
        <th scope="col">AWS Connect username (agent only)</th>
        <th scope="col">AWS Connect credentials (agent only)</th>
    </tr>
    </thead>
    <tbody>
    {% for user in user_list %}
    <tr>
        <td>{{user.name}}</td>
        <td>{{user.PIN}}</td>
        <td>{{user.type}}</td>
        {% if user.type == "agent" %}
        <td>{{user.account.username}}</td>
        <td>
            <button class="btn btn-link"
                    onclick="toggleButton({{user.PIN}}, this)">Show
            </button>
            <a class="alert alert-secondary" style="visibility:hidden;" id="{{user.PIN}}">{{user.account.password}}</a>
        </td>
        {% else %}
        <td>-</td>
        <td>-</td>
        {% endif %}
    </tr>
    {% endfor %}
    </tbody>
</table>

<div class="alert alert-primary" role="alert">
    User Guide
</div>
<table class="table">
    <tbody>
    <tr>
        <th scope="row">Amazon Connect Phone Number (Customer Only)</th>
        <td><a class="btn">{{amazon_connect_phone_number}}</a></td>
    </tr>
    <tr>
        <th scope="row">Amazon Connect Contact Center Portal (Agent Only)</th>
        <td><a class="btn btn-link" href="{{amazon_connect_ccp_link}}">{{amazon_connect_ccp_link}}</a></td>
    </tr>
    </tbody>
</table>
{% endif %}
{% endblock %}